function q(y){return y&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y}var D={exports:{}},F;function z(){return F||(F=1,(function(y){var w=w||{REVISION:"ALPHA"};(function(A){var M=function(a,r){if(!a)throw r||"Assertion failed"},S=function(a,r,v){return a.hasOwnProperty(r)?a[r]:v},G=!1,E=0,x=function(){if(G)return G=!1,E;var a=2*Math.random()-1,r=2*Math.random()-1,v=a*a+r*r;if(v==0||v>1)return x();var o=Math.sqrt(-2*Math.log(v)/v);return E=r*o,G=!0,a*o},L=function(a,r){return a+x()*r},g=function(a){if(typeof a>"u"||isNaN(a))return[];if(typeof ArrayBuffer>"u"){for(var r=new Array(a),v=0;v<a;v++)r[v]=0;return r}else return new Float64Array(a)},I=function(a,r,v){for(var o=typeof v<"u",t=[],s=0;s<a;s++){for(var e=[],i=0;i<r;i++)o?e.push(v):e.push(L(0,1e-4));t.push(e)}return t},Q=function(a,r){for(var v=a.length,o=0,t=0;t<v;t++){var s=a[t],e=r[t];o+=(s-e)*(s-e)}return o},T=function(a){for(var r=a.length,v=g(r*r),o=0;o<r;o++)for(var t=o+1;t<r;t++){var s=Q(a[o],a[t]);v[o*r+t]=s,v[t*r+o]=s}return v},O=function(a,r,v){var o=Math.sqrt(a.length),t=Math.floor(o);M(t===o,"D should have square number of elements.");for(var s=Math.log(r),e=g(t*t),i=g(t),n=0;n<t;n++){for(var c=-1/0,h=1/0,u=1,p=!1,Y=50,m=0;!p;){for(var N=0,f=0;f<t;f++){var l=Math.exp(-a[n*t+f]*u);n===f&&(l=0),i[f]=l,N+=l}for(var d=0,f=0;f<t;f++){var l=i[f]/N;i[f]=l,l>1e-7&&(d-=l*Math.log(l))}d>s?(c=u,h===1/0?u=u*2:u=(u+h)/2):(h=u,c===-1/0?u=u/2:u=(u+c)/2),m++,Math.abs(d-s)<v&&(p=!0),m>=Y&&(p=!0)}for(var f=0;f<t;f++)e[n*t+f]=i[f]}for(var P=g(t*t),k=t*2,n=0;n<t;n++)for(var f=0;f<t;f++)P[n*t+f]=Math.max((e[n*t+f]+e[f*t+n])/k,1e-100);return P};function R(a){return a>0?1:a<0?-1:0}var _=function(r){var r=r||{};this.perplexity=S(r,"perplexity",30),this.dim=S(r,"dim",2),this.epsilon=S(r,"epsilon",10),this.iter=0};_.prototype={initDataRaw:function(a){var r=a.length,v=a[0].length;M(r>0," X is empty? You must have some data!"),M(v>0," X[0] is empty? Where is the data?");var o=T(a);this.P=O(o,this.perplexity,1e-4),this.N=r,this.initSolution()},initDataDist:function(a){var r=a.length;M(r>0," X is empty? You must have some data!");for(var v=g(r*r),o=0;o<r;o++)for(var t=o+1;t<r;t++){var s=a[o][t];v[o*r+t]=s,v[t*r+o]=s}this.P=O(v,this.perplexity,1e-4),this.N=r,this.initSolution()},initSolution:function(){this.Y=I(this.N,this.dim),this.gains=I(this.N,this.dim,1),this.ystep=I(this.N,this.dim,0),this.iter=0},getSolution:function(){return this.Y},step:function(){this.iter+=1;for(var a=this.N,r=this.costGrad(this.Y),v=r.cost,o=r.grad,t=g(this.dim),s=0;s<a;s++)for(var e=0;e<this.dim;e++){var i=o[s][e],n=this.ystep[s][e],c=this.gains[s][e],h=R(i)===R(n)?c*.8:c+.2;c<.01&&(c=.01),this.gains[s][e]=h;var u=this.iter<250?.5:.8,p=u*n-this.epsilon*h*o[s][e];this.ystep[s][e]=p,this.Y[s][e]+=p,t[e]+=this.Y[s][e]}for(var s=0;s<a;s++)for(var e=0;e<this.dim;e++)this.Y[s][e]-=t[e]/a;return v},debugGrad:function(){var a=this.N,r=this.costGrad(this.Y);r.cost;for(var v=r.grad,o=1e-5,t=0;t<a;t++)for(var s=0;s<this.dim;s++){var e=this.Y[t][s];this.Y[t][s]=e+o;var i=this.costGrad(this.Y);this.Y[t][s]=e-o;var n=this.costGrad(this.Y),c=v[t][s],h=(i.cost-n.cost)/(2*o);console.log(t+","+s+": gradcheck analytic: "+c+" vs. numerical: "+h),this.Y[t][s]=e}},costGrad:function(a){for(var r=this.N,v=this.dim,o=this.P,t=this.iter<100?4:1,s=g(r*r),e=0,i=0;i<r;i++)for(var n=i+1;n<r;n++){for(var c=0,h=0;h<v;h++){var u=a[i][h]-a[n][h];c+=u*u}var p=1/(1+c);s[i*r+n]=p,s[n*r+i]=p,e+=2*p}for(var Y=r*r,m=g(Y),N=0;N<Y;N++)m[N]=Math.max(s[N]/e,1e-100);for(var f=0,l=[],i=0;i<r;i++){for(var d=new Array(v),h=0;h<v;h++)d[h]=0;for(var n=0;n<r;n++){f+=-o[i*r+n]*Math.log(m[i*r+n]);for(var P=4*(t*o[i*r+n]-m[i*r+n])*s[i*r+n],h=0;h<v;h++)d[h]+=P*(a[i][h]-a[n][h])}l.push(d)}return{cost:f,grad:l}}},A.tSNE=_})(w),(function(A){y.exports=A})(w)})(D)),D.exports}var B=z();const C=q(B);export{q as g,C as t};
